<?php  $req_fichiers = $pdo->query("SELECT * FROM fichiers ORDER BY date DESC");  $fichiers = $req_fichiers->fetchALL();  $req_category = $pdo->query("SELECT * FROM categories");  $categories = $req_category->fetchAll();  $search=$_GET['s'];  $get_delete=$_GET['del'];  if(!empty($search)){    $req_fichiers = $pdo->query("SELECT * FROM `fichiers` WHERE `titre` LIKE '%".$search."%' OR `description` LIKE '%".$search."%' ORDER BY date DESC");    $fichiers = $req_fichiers->fetchAll();  }  if(empty($fichiers)){    $error .= "Aucun fichier trouvé :(";  }  if(!empty($get_delete)){    $success .= "Votre fichier à bien été suprimé! :)";  }  // Modification du fichier  $titre = $_POST['titre'];  $description = $_POST['description'];  $id = $_POST['id'];  //d'abord on s'assure que le formulaire  //a bien été envoyé  if(!empty($_POST)){    //si le titre est vide, prépare l'erreur à    //afficher à l'utilisateur    if(empty($titre)){      $erreur .= "Vous devez indiquez un titre<br>";    }    //si le description est vide...    if(empty($description)){      $erreur .= "Votre description ne doit pas être vide.<br>";    }    //On check que tous les champs sont complétés    if(!empty($titre) AND !empty($description)){      // Write data to MySql      if(empty($erreur)){        $insert = $pdo->prepare("UPDATE fichiers SET titre = :titre, description = :description WHERE id = :id ");        $insert->bindValue(':titre', $titre);        $insert->bindValue(':description', $description);        $insert->bindValue(':id', $id);        $insert->execute();        header("Location: index.php");      }    }  }?><?php if(!empty($get_delete)): ?>    <p class="bg-success" style="padding:15px">      <?php echo $success ?>    </p><?php endif ?><?php if(!empty($error)): ?>    <p class="bg-success" style="padding:15px">      <?php echo $error ?>    </p><?php endif ?><h1 class="page-header">  Documentation  <?php if(!empty($search)): ?>    <small>Recherche effectué pour "<?php echo $search; ?>".</small>  <?php endif ?></h1><div class="col-md-4">  <section>    <form action="index.php" method="GET">      <div class="input-group">        <input type="text" class="form-control" name="s" placeholder="Chercher un document..." value="<?php if(!empty($search)) echo $search ?>">        <?php if(!empty($search)): ?>          <a class="glyphicon delete_search" href="http://www.myprocom.ch/~vritz/atelier2"></a>        <?php endif ?>        <span class="input-group-btn">          <button class="btn btn-default" type="submit">Go!</button>        </span>      </div>    </form>  </section>  <section class="cat_try">    <ul class="list-group">      <?php foreach ($categories as $key => $category): ?>        <a href="#" class="list-group-item <?php echo $category["category"]; ?>">          <span class="glyphicon glyphicon-folder-open"></span> <?php echo $category["category"]; ?><div class="vu glyphicon"></div>          <span class="badge">          <?php            $counter=0;            foreach ($fichiers as $key => $fichier){              if($fichier['category_id'] == $category['id']){                $counter++;              }            } ?>            <?php echo $counter; ?> fichiers          </span>        </a>      <?php endforeach ?>    </ul>  </section></div><div class="results col-md-8">  <div class="edit">  </div>  <?php foreach ($fichiers as $key => $fichier): ?>    <?php      foreach ($categories as $key => $category){        if($fichier['category_id'] == $category['id']){          $cat_id = $category['category'];        }      }    ?>    <ul class="list-group cat <?php echo $cat_id; ?>">      <li class="list-group-item">        <h4><span class="glyphicon glyphicon-file"></span> <?php echo $fichier["titre"]; ?><small> [<?php echo human_filesize($fichier["size"]); ?>] <?php $phpdate = strtotime( $fichier["date"] ); echo 'Uploadé le '.date( 'd-m-Y', $phpdate ).'.'; ?></small></h4>        <ul class="pagination pull-right">          <li class="infos"><a href="#"><span class="glyphicon glyphicon-info-sign"></span></a><div class="dropdown"><?php echo $fichier["description"]; ?></div></li>          <?php if (!empty($_SESSION['username'])): ?>            <li class="edit-file"><a href=""><span class="glyphicon glyphicon-pencil"></span></a></li>            <div class="hidden-form modal">              <form class="form-group" method="POST" enctype="multipart/form-data">                <div class="modal-body">                  <input class="form-control" type="text" name="titre" value="<?php echo $fichier["titre"]; ?>" /><br>                  <textarea class="form-control" name="description" /><?php echo $fichier["description"]; ?></textarea><br>                   <input type="hidden" name="id" value="<?php echo $fichier['id'] ?>"/>                </div>                <div class="modal-footer">                  <a href="#" class="btn close-form">Fermer</a>                  <input class="btn btn-primary" type="submit" value="Enregistrer."/>                </div>              </form>            </div>            <li><a class="delete_file" href="?page=supprimer_fichier&fichier_id=<?php echo $fichier['id'] ?>"><span class="glyphicon glyphicon-trash"></span></a></li>          <?php endif ?>          <li><a href="http://www.myprocom.ch/~vritz/atelier2/files/<?php echo $fichier["fichier"]; ?>"><span class="glyphicon glyphicon-download"></span></a></li>        </ul>      </li>    </ul>  <?php endforeach ?></div><div class="clear"></div>